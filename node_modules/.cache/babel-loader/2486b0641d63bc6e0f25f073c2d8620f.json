{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _reactDom = _interopRequireDefault(require(\"react-dom\"));\n\nvar _lodash = require(\"lodash\");\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _framework7LiteEsmBundle = _interopRequireDefault(require(\"framework7/framework7-lite.esm.bundle.js\"));\n\nvar _fUi = _interopRequireDefault(require(\"@hvisions/f-ui\"));\n\nvar _store = _interopRequireDefault(require(\"./store\"));\n\nvar _plugin = require(\"./plugin\");\n\nvar _toolkit = require(\"@hvisions/toolkit\");\n\nvar _Root = _interopRequireDefault(require(\"./components/Root\"));\n\nvar _Context = _interopRequireDefault(require(\"./components/Config/Context\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _toConsumableArray(arr) {\n  return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread();\n}\n\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance\");\n}\n\nfunction _iterableToArray(iter) {\n  if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter);\n}\n\nfunction _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) {\n    for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) {\n      arr2[i] = arr[i];\n    }\n\n    return arr2;\n  }\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(source, true).forEach(function (key) {\n        _defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(source).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar modules = [];\nvar HomeConfigs = {};\nvar NextConfigs = {};\nvar isSaas = false; // func useModule\n// export function use(module) {\n//   modules.push(module);\n// }\n\nvar Core = /*#__PURE__*/function () {\n  function Core(options) {\n    _classCallCheck(this, Core);\n\n    var router = options.router,\n        store = options.store,\n        _options$locales = options.locales,\n        locales = _options$locales === void 0 ? {} : _options$locales,\n        login = options.login,\n        layout = options.layout,\n        _options$moduleConfig = options.moduleConfig,\n        moduleConfig = _options$moduleConfig === void 0 ? {} : _options$moduleConfig,\n        _options$theme = options.theme,\n        theme = _options$theme === void 0 ? 'ios' : _options$theme,\n        _options$HomeConfig = options.HomeConfig,\n        HomeConfig = _options$HomeConfig === void 0 ? {\n      needBottomBar: true\n    } : _options$HomeConfig,\n        nextHomeConfig = options.nextHomeConfig,\n        _options$saas = options.saas,\n        saas = _options$saas === void 0 ? false : _options$saas;\n    this.router = router;\n    this.store = store;\n    this.locales = locales;\n    this.login = login ? login : require(\"./components/Login\");\n    this.layout = layout ? layout : require(\"./components/Layout\");\n    this.moduleConfig = moduleConfig;\n    this.theme = theme;\n    isSaas = saas;\n    HomeConfigs = HomeConfig || {};\n    NextConfigs = nextHomeConfig || {};\n\n    _toolkit.session.setSaas(saas);\n  }\n\n  _createClass(Core, [{\n    key: \"getReducers\",\n    value: function getReducers() {\n      var moduleReducers = modules.reduce(function (p, c) {\n        return _objectSpread({}, p, {}, c.store);\n      }, {});\n      var loginReducers = this.login.store;\n      var layoutReducers = this.layout.store;\n      return _objectSpread({}, moduleReducers, {}, loginReducers, {}, layoutReducers, {}, this.store);\n    } // 先合并数组 然后再追加数组。经过测试数组长度为30时,执行的时长为1ms。因此次算法的性能基本可以满足。\n\n  }, {\n    key: \"concatNotSort\",\n    value: function concatNotSort(arr1, arr2) {\n      var newArr = [].concat(_toConsumableArray(arr1), _toConsumableArray(arr2));\n      var pathArr = [].concat(_toConsumableArray(arr1.map(function (item) {\n        return item.path;\n      })), _toConsumableArray(arr2.map(function (item) {\n        return item.path;\n      })));\n      var updateArr = [];\n      pathArr.forEach(function (item, index) {\n        if (updateArr.map(function (item) {\n          return item.path;\n        }).indexOf(item) === -1) {\n          updateArr.push(newArr[index]);\n        } else {\n          var i = updateArr.map(function (item) {\n            return item.path;\n          }).indexOf(item);\n          delete updateArr[i];\n          updateArr.push(newArr[index]);\n        }\n      });\n      return updateArr;\n    }\n  }, {\n    key: \"initPlugins\",\n    value: function initPlugins() {\n      var _registerPlugins = (0, _plugin.registerPlugins)(),\n          routers = _registerPlugins.routers,\n          stores = _registerPlugins.stores,\n          locales = _registerPlugins.locales;\n\n      this.pluginRouter = routers;\n      this.pluginStore = stores;\n      this.pluginLocales = locales;\n    }\n  }, {\n    key: \"getRouters\",\n    value: function getRouters() {\n      var moduleRoutes = (0, _lodash.flattenDeep)(modules.map(function (m) {\n        return m.router;\n      }));\n\n      function checkAuth(to, from, resolve, reject) {\n        var router = this;\n\n        if (_toolkit.session.isLoggedIn()) {\n          resolve();\n        } else {\n          reject();\n          router.navigate('/login');\n        }\n      }\n\n      var routers = this.concatNotSort(moduleRoutes, this.router).map(function (r) {\n        if ((0, _lodash.isArray)(r.beforeEnter)) {\n          r.beforeEnter = [].concat(_toConsumableArray(r.beforeEnter), [checkAuth]);\n        } else if (r.beforeEnter) {\n          r.beforeEnter = [r.beforeEnter, checkAuth];\n        } else {\n          r.beforeEnter = checkAuth;\n        }\n\n        return r;\n      });\n      return routers;\n    }\n  }, {\n    key: \"setLocales\",\n    value: function setLocales() {\n      modules.forEach(function (m) {\n        _toolkit.i18n.setLocales(m.locale);\n      });\n\n      _toolkit.i18n.setLocales(this.locales);\n    } // func mount\n\n  }, {\n    key: \"mount\",\n    value: function mount(selector) {\n      var _this = this;\n\n      var initialState = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      this.initPlugins();\n\n      _framework7LiteEsmBundle.default.use(_fUi.default);\n\n      this.setLocales();\n\n      var locale = _toolkit.i18n.getLocalSettings();\n\n      var store = (0, _store.default)(this.getReducers(), initialState);\n\n      _toolkit.i18n.load(locale).then(function () {\n        _reactDom.default.render(_react.default.createElement(_reactRedux.Provider, {\n          store: store\n        }, _react.default.createElement(_Context.default.Provider, {\n          value: _this.moduleConfig\n        }, _react.default.createElement(_Root.default, {\n          routes: _this.getRouters(),\n          theme: _this.theme\n        }))), document.querySelector(selector));\n      });\n    }\n  }]);\n\n  return Core;\n}();\n\nexports.default = Core;\n\n_defineProperty(Core, \"use\", function (module) {\n  modules.push(module);\n});\n\n_defineProperty(Core, \"getSaas\", function () {\n  return isSaas;\n});\n\n_defineProperty(Core, \"plugin\", function (p) {\n  return (0, _plugin.addPlugin)(p);\n});\n\n_defineProperty(Core, \"getHomeConfig\", function () {\n  return HomeConfigs;\n});\n\n_defineProperty(Core, \"getNextHomeConfig\", function () {\n  return NextConfigs;\n});","map":null,"metadata":{},"sourceType":"script"}