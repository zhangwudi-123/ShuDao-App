{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"F:\\\\project\\\\vsCode\\\\bc-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireWildcard(require(\"react\"));\n\nvar _reactRedux = require(\"react-redux\");\n\nvar types = _interopRequireWildcard(require(\"../store/core/types\"));\n\nvar _session = _interopRequireDefault(require(\"../api/session\"));\n\nvar _menu = _interopRequireDefault(require(\"../api/menu\"));\n\nvar _fUi = require(\"@hvisions/f-ui\");\n\nvar _toolkit = require(\"@hvisions/toolkit\");\n\nvar _lodash = require(\"lodash\");\n\nvar _Profile = _interopRequireDefault(require(\"./Profile\"));\n\nvar _style = _interopRequireDefault(require(\"./style.scss\"));\n\nvar _Events = require(\"../utils/Events\");\n\nvar _session2 = require(\"../utils/session\");\n\nvar _Context = _interopRequireDefault(require(\"./Config/Context\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _getRequireWildcardCache() {\n  if (typeof WeakMap !== \"function\") return null;\n  var cache = new WeakMap();\n\n  _getRequireWildcardCache = function _getRequireWildcardCache() {\n    return cache;\n  };\n\n  return cache;\n}\n\nfunction _interopRequireWildcard(obj) {\n  if (obj && obj.__esModule) {\n    return obj;\n  }\n\n  var cache = _getRequireWildcardCache();\n\n  if (cache && cache.has(obj)) {\n    return cache.get(obj);\n  }\n\n  var newObj = {};\n\n  if (obj != null) {\n    var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor;\n\n    for (var key in obj) {\n      if (Object.prototype.hasOwnProperty.call(obj, key)) {\n        var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null;\n\n        if (desc && (desc.get || desc.set)) {\n          Object.defineProperty(newObj, key, desc);\n        } else {\n          newObj[key] = obj[key];\n        }\n      }\n    }\n  }\n\n  newObj.default = obj;\n\n  if (cache) {\n    cache.set(obj, newObj);\n  }\n\n  return newObj;\n}\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _slicedToArray(arr, i) {\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\n}\n\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}\n\nfunction _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}\n\nfunction _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}\n\nvar LayoutControl = function LayoutControl(_ref) {\n  var LayoutComponent = _ref.LayoutComponent,\n      routes = _ref.routes;\n  return function Wrap(props) {\n    var moduleConfig = (0, _react.useContext)(_Context.default);\n\n    var _dispatch = (0, _reactRedux.useDispatch)();\n\n    var _core = (0, _reactRedux.useSelector)(function (_ref2) {\n      var core = _ref2.core;\n      return core;\n    });\n\n    var _useState = (0, _react.useState)([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        moduleList = _useState2[0],\n        setModuleList = _useState2[1];\n\n    var _useState3 = (0, _react.useState)('/'),\n        _useState4 = _slicedToArray(_useState3, 2),\n        currentPath = _useState4[0],\n        setCurrentPath = _useState4[1];\n\n    var _useState5 = (0, _react.useState)(false),\n        _useState6 = _slicedToArray(_useState5, 2),\n        ptrPreloader = _useState6[0],\n        setPtrPreloader = _useState6[1];\n\n    (0, _react.useEffect)(function () {\n      if (!_toolkit.session.getAuthData()) {\n        props.$f7router.navigate('/login');\n        return;\n      }\n\n      if (moduleConfig.message && (0, _session2.getMessageOn)() == 'TRUE') {\n        _Events.systemEvents.emit('message-ws-establish');\n      }\n\n      if ((0, _lodash.isEmpty)(_core.moduleList)) {\n        _session.default.findMenus(_toolkit.session.getAuthData().id).then(function (data) {\n          _dispatch({\n            type: types.CHANGE_MODULE_LIST,\n            moduleList: data\n          });\n\n          setModuleList(data);\n        });\n      } else {\n        setModuleList(_core.moduleList);\n      }\n\n      (0, _lodash.isEmpty)(_core.homeMenus) && _menu.default.findByUserId().then(function (res) {\n        if (!(0, _lodash.isEmpty)(res)) {\n          _dispatch({\n            type: types.CHANGE_HOME_MENU,\n            homeMenus: res.map(function (i) {\n              return {\n                icon: i.icon,\n                id: i.menuId,\n                fullName: i.menuName,\n                urlAddress: i.menuUrl\n              };\n            })\n          });\n        }\n      }); // isEmpty(_core.toolbarList) &&\n      //   menuApi.findLevelOneByUserId().then((res) => {\n      //     if (!isEmpty(res)) {\n      //       _dispatch({\n      //         type: types.CHANGE_TOOLBAR_LIST,\n      //         toolbarList: res.map((i) => ({\n      //           id: i.menuId,\n      //           path: i.menuUrl,\n      //           text: i.menuName,\n      //           icon: i.icon || 'circle_grid_3x3'\n      //         }))\n      //       });\n      //     }\n      //   });\n    }, []);\n\n    var toolbarClick = function toolbarClick(path) {\n      return function () {\n        setCurrentPath(path);\n      };\n    };\n\n    var renderLink = function renderLink() {\n      return _core.toolbarList.map(function (item, index) {\n        return _react.default.createElement(_fUi.Link, {\n          key: index,\n          tabLinkActive: currentPath === item.path,\n          text: item.text,\n          iconIos: \"f7:\".concat(item.icon),\n          onClick: toolbarClick(item.path),\n          style: {\n            fontSize: 12\n          }\n        });\n      });\n    };\n    /**\n     * ### Toolbar导航栏切换后触发\n     * - 配置后的Toolbar切换进入的页面,\n     * - 因为Toolbar只能配置一级菜单,\n     * - 默认会把当前菜单下的所有子项`modules`带入组件供使用.\n     * @returns {JSX.Element} 返回选中Toolbar的页面\n     */\n\n\n    var renderToolbarComponent = function renderToolbarComponent() {\n      var _current = _core.toolbarList.find(function (item) {\n        return currentPath === item.path;\n      });\n\n      if (!_current) {\n        return null;\n      }\n\n      var tempRoute = routes.find(function (p) {\n        return p.path === _current.path;\n      });\n      var Com = !(0, _lodash.isEmpty)(tempRoute) && tempRoute.component;\n\n      var _moduleTree = _toolkit.tree.formatTree(moduleList);\n\n      var modulesChildren = _moduleTree.find(function (m) {\n        return m.urlAddress === _current.path;\n      });\n\n      var modules = !(0, _lodash.isEmpty)(modulesChildren) && modulesChildren.children;\n      return _react.default.createElement(Com, {\n        modules: modules,\n        moduleList: moduleList\n      });\n    };\n    /**\n     * ### 下拉刷新菜单\n     \n     */\n\n\n    var handleRefresh = /*#__PURE__*/function () {\n      var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(done) {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return _session.default.findMenus(_toolkit.session.getAuthData().id).then(function (data) {\n                  _dispatch({\n                    type: types.CHANGE_MODULE_LIST,\n                    moduleList: data\n                  });\n\n                  setModuleList(data);\n                });\n\n              case 2:\n                _context.next = 4;\n                return _menu.default.findByUserId().then(function (res) {\n                  if (!(0, _lodash.isEmpty)(res)) {\n                    _dispatch({\n                      type: types.CHANGE_HOME_MENU,\n                      homeMenus: res.map(function (i) {\n                        return {\n                          icon: i.icon,\n                          id: i.menuId,\n                          fullName: i.menuName,\n                          urlAddress: i.menuUrl\n                        };\n                      })\n                    });\n                  }\n                });\n\n              case 4:\n                _context.next = 6;\n                return setPtrPreloader(false);\n\n              case 6:\n                done();\n\n              case 7:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n\n      return function handleRefresh(_x) {\n        return _ref3.apply(this, arguments);\n      };\n    }();\n\n    return _react.default.createElement(_fUi.Page, {\n      noNavbar: true,\n      className: _style.default.homepage,\n      pageContent: false\n    }, _react.default.createElement(_fUi.PageContent, {\n      ptrPreloader: ptrPreloader,\n      ptr: true,\n      onPtrRefresh: handleRefresh,\n      onPtrPullStart: function onPtrPullStart() {\n        setPtrPreloader(true);\n      }\n    }, currentPath === '/' && _react.default.createElement(LayoutComponent, _extends({\n      moduleList: moduleList\n    }, props)), currentPath === '/profile' && _react.default.createElement(_Profile.default, props)), _react.default.createElement(_fUi.Toolbar, {\n      tabbar: true,\n      labels: true,\n      noHairline: true,\n      position: \"bottom\"\n    }, _react.default.createElement(_fUi.Link, {\n      tabLinkActive: currentPath === '/',\n      text: \"\\u9996\\u9875\",\n      icon: \"ne-icon-homepage\",\n      onClick: toolbarClick('/'),\n      style: {\n        fontSize: 12\n      }\n    }), _react.default.createElement(_fUi.Link, {\n      text: \"\\u6211\\u7684\",\n      tabLinkActive: currentPath === '/profile',\n      icon: \"ne-icon-profile\",\n      onClick: toolbarClick('/profile'),\n      style: {\n        fontSize: 12\n      }\n    })));\n  };\n};\n\nvar _default = LayoutControl;\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}