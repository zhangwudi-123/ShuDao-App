{"ast":null,"code":"var _jsxFileName = \"F:\\\\project\\\\vsCode\\\\bc-app\\\\src\\\\pages\\\\PreparationOrder\\\\MaterialSearch\\\\index.js\";\nimport React, { useEffect, useMemo, useState, useRef } from 'react';\nimport { Row, Col, Icon, BlockTitle, Block, SkeletonBlock, Page, Navbar, NavLeft, NavTitle, ListInput, List, Subnavbar, Searchbar, ListItem, PageContent } from '@hvisions/f-ui';\nimport moment from 'moment';\nimport materialService from '~/api/materialService';\nimport { session, tree } from '@hvisions/toolkit';\nimport { isEmpty, debounce } from 'lodash';\nimport styles from './style.scss';\nimport backIcon from '~/pages/WarehousinManage/img/backIcon.png';\n\nconst MaterialSearch = _ref => {\n  let {\n    f7router,\n    moduleList,\n    handleCreateSelect,\n    ...props\n  } = _ref;\n  const [searchOptions, setSearchOptions] = useState([]);\n  const [searchParams, setSearchParams] = useState({});\n  const [allowInfinite, setAllowInfinite] = useState(true);\n  const [showPreloader, setShowPreloader] = useState(false);\n  const totalElements = useRef(0);\n  const pageInfo = useRef({\n    page: 0,\n    pageSize: 30\n  });\n\n  const handleSearch = () => {\n    const tempParams = { ...searchParams,\n      ...pageInfo.current\n    };\n    materialService.getMaterialByNameOrCode(tempParams, null).then(res => {\n      const data = res.content.map(i => {\n        var _i$extend;\n\n        return {\n          text: `${i.materialCode} ${i.materialName} ${((_i$extend = i.extend) === null || _i$extend === void 0 ? void 0 : _i$extend.specification) || ''}`,\n          value: i.id // materialCode:i.materialCode,\n\n        };\n      });\n      totalElements.current = res.totalElements;\n      setSearchOptions(data);\n\n      if (res.totalElements <= pageInfo.current.pageSize) {\n        setAllowInfinite(false);\n        return;\n      } else {\n        setAllowInfinite(true);\n      }\n    });\n    setShowPreloader(false);\n  };\n\n  const debounceSetParams = debounce(value => {\n    pageInfo.current = {\n      page: 0,\n      pageSize: 30\n    };\n    setSearchOptions([]);\n    setSearchParams(value);\n  }, 300);\n\n  const handleselect = item => {\n    if (handleCreateSelect) {\n      // f7router.navigate('/yw-preparation-order', {\n      //   props: {\n      //     createMaterial: item,\n      //     createDate: props.createDate,\n      //     selectedMaterial: props.selectedMaterial,\n      //     date: props.date\n      //   }\n      // });\n      handleCreateSelect(item);\n    } else {\n      f7router.navigate('/yw-preparation-order', {\n        props: {\n          selectedMaterial: item,\n          date: props.date\n        }\n      });\n    }\n  };\n\n  useEffect(() => {\n    handleSearch();\n  }, [searchParams]);\n\n  const loadMore = async () => {\n    if (!allowInfinite) return;\n    setAllowInfinite(false);\n    setShowPreloader(true);\n\n    if (totalElements.current <= pageInfo.current.pageSize) {\n      setShowPreloader(false);\n      return;\n    }\n\n    pageInfo.current = {\n      page: 0,\n      pageSize: pageInfo.current.pageSize + 30\n    };\n    await handleSearch();\n  };\n\n  return /*#__PURE__*/React.createElement(Page, {\n    pageContent: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Navbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(NavLeft, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 9\n    }\n  }, handleCreateSelect == undefined && /*#__PURE__*/React.createElement(\"a\", {\n    onClick: () => f7router.navigate('/yw-preparation-order', {\n      force: true,\n      props: {\n        date: props.date,\n        selectedMaterial: props.selectedMaterial\n      }\n    }),\n    className: \"ne-navleft\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    alt: \"\",\n    style: {\n      height: 24\n    },\n    src: backIcon,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 15\n    }\n  }))), /*#__PURE__*/React.createElement(NavTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 9\n    }\n  }, \"\\u8BF7\\u9009\\u62E9\\u7269\\u6599\"), /*#__PURE__*/React.createElement(Subnavbar, {\n    inner: false,\n    className: styles.subnavbar,\n    noHairline: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Searchbar, {\n    className: styles.searchBar,\n    placeholder: \"\\u8BF7\\u8F93\\u5165\\u5173\\u952E\\u8BCD\",\n    disableButton: false,\n    searchContainer: \".search-list\",\n    clearButton: false,\n    searchIn: \".item-title\",\n    style: {\n      fontSize: 13\n    },\n    onChange: e => {\n      debounceSetParams({\n        keyWord: e.target.value\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(PageContent, {\n    infinite: true,\n    infiniteDistance: 50,\n    infinitePreloader: showPreloader,\n    onInfinite: loadMore,\n    style: {\n      paddingTop: '88px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(List, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(ListItem, {\n    title: \"\\u5168\\u90E8\\u7C7B\\u578B\",\n    onClick: () => handleselect({\n      value: undefined,\n      text: '全部类型'\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 11\n    }\n  }), searchOptions.map((item, index) => {\n    return /*#__PURE__*/React.createElement(ListItem, {\n      key: index,\n      title: item.text,\n      onClick: () => handleselect(item),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 20\n      }\n    });\n  }))));\n};\n\nexport default MaterialSearch;","map":{"version":3,"names":["React","useEffect","useMemo","useState","useRef","Row","Col","Icon","BlockTitle","Block","SkeletonBlock","Page","Navbar","NavLeft","NavTitle","ListInput","List","Subnavbar","Searchbar","ListItem","PageContent","moment","materialService","session","tree","isEmpty","debounce","styles","backIcon","MaterialSearch","f7router","moduleList","handleCreateSelect","props","searchOptions","setSearchOptions","searchParams","setSearchParams","allowInfinite","setAllowInfinite","showPreloader","setShowPreloader","totalElements","pageInfo","page","pageSize","handleSearch","tempParams","current","getMaterialByNameOrCode","then","res","data","content","map","i","text","materialCode","materialName","extend","specification","value","id","debounceSetParams","handleselect","item","navigate","selectedMaterial","date","loadMore","undefined","force","height","subnavbar","searchBar","fontSize","e","keyWord","target","paddingTop","index"],"sources":["F:/project/vsCode/bc-app/src/pages/PreparationOrder/MaterialSearch/index.js"],"sourcesContent":["import React, { useEffect, useMemo, useState, useRef } from 'react';\r\nimport {\r\n  Row,\r\n  Col,\r\n  Icon,\r\n  BlockTitle,\r\n  Block,\r\n  SkeletonBlock,\r\n  Page,\r\n  Navbar,\r\n  NavLeft,\r\n  NavTitle,\r\n  ListInput,\r\n  List,\r\n  Subnavbar,\r\n  Searchbar,\r\n  ListItem,\r\n  PageContent\r\n} from '@hvisions/f-ui';\r\nimport moment from 'moment';\r\nimport materialService from '~/api/materialService';\r\nimport { session, tree } from '@hvisions/toolkit';\r\nimport { isEmpty, debounce } from 'lodash';\r\nimport styles from './style.scss';\r\n\r\nimport backIcon from '~/pages/WarehousinManage/img/backIcon.png';\r\nconst MaterialSearch = ({ f7router, moduleList, handleCreateSelect, ...props }) => {\r\n  const [searchOptions, setSearchOptions] = useState([]);\r\n  const [searchParams, setSearchParams] = useState({});\r\n  const [allowInfinite, setAllowInfinite] = useState(true);\r\n  const [showPreloader, setShowPreloader] = useState(false);\r\n  const totalElements = useRef(0);\r\n  const pageInfo = useRef({ page: 0, pageSize: 30 });\r\n  const handleSearch = () => {\r\n    const tempParams = { ...searchParams, ...pageInfo.current };\r\n    materialService.getMaterialByNameOrCode(tempParams, null).then(res => {\r\n      const data = res.content.map(i => ({\r\n        text: `${i.materialCode} ${i.materialName} ${i.extend?.specification || ''}`,\r\n        value: i.id\r\n        // materialCode:i.materialCode,\r\n      }));\r\n      totalElements.current = res.totalElements;\r\n      setSearchOptions(data);\r\n\r\n      if (res.totalElements <= pageInfo.current.pageSize) {\r\n        setAllowInfinite(false);\r\n        return;\r\n      } else {\r\n        setAllowInfinite(true);\r\n      }\r\n    });\r\n\r\n    setShowPreloader(false);\r\n  };\r\n  const debounceSetParams = debounce(value => {\r\n    pageInfo.current = { page: 0, pageSize: 30 };\r\n    setSearchOptions([]);\r\n    setSearchParams(value);\r\n  }, 300);\r\n  const handleselect = item => {\r\n    if (handleCreateSelect) {\r\n      // f7router.navigate('/yw-preparation-order', {\r\n      //   props: {\r\n      //     createMaterial: item,\r\n      //     createDate: props.createDate,\r\n      //     selectedMaterial: props.selectedMaterial,\r\n      //     date: props.date\r\n      //   }\r\n      // });\r\n      handleCreateSelect(item);\r\n    } else {\r\n      f7router.navigate('/yw-preparation-order', {\r\n        props: { selectedMaterial: item, date: props.date }\r\n      });\r\n    }\r\n  };\r\n  useEffect(() => {\r\n    handleSearch();\r\n  }, [searchParams]);\r\n  const loadMore = async () => {\r\n    if (!allowInfinite) return;\r\n    setAllowInfinite(false);\r\n    setShowPreloader(true);\r\n    if (totalElements.current <= pageInfo.current.pageSize) {\r\n      setShowPreloader(false);\r\n      return;\r\n    }\r\n    pageInfo.current = { page: 0, pageSize: pageInfo.current.pageSize + 30 };\r\n    await handleSearch();\r\n  };\r\n\r\n  return (\r\n    <Page pageContent={false}>\r\n      <Navbar>\r\n        <NavLeft>\r\n          {handleCreateSelect == undefined && (\r\n            <a\r\n              onClick={() =>\r\n                f7router.navigate('/yw-preparation-order', {\r\n                  force: true,\r\n                  props: {\r\n                    date: props.date,\r\n                    selectedMaterial: props.selectedMaterial\r\n                  }\r\n                })\r\n              }\r\n              className=\"ne-navleft\"\r\n            >\r\n              <img alt=\"\" style={{ height: 24 }} src={backIcon} />\r\n            </a>\r\n          )}\r\n        </NavLeft>\r\n        <NavTitle>请选择物料</NavTitle>\r\n        <Subnavbar inner={false} className={styles.subnavbar} noHairline>\r\n          <Searchbar\r\n            className={styles.searchBar}\r\n            placeholder=\"请输入关键词\"\r\n            disableButton={false}\r\n            searchContainer=\".search-list\"\r\n            clearButton={false}\r\n            searchIn=\".item-title\"\r\n            style={{ fontSize: 13 }}\r\n            onChange={e => {\r\n              debounceSetParams({ keyWord: e.target.value });\r\n            }}\r\n          ></Searchbar>\r\n        </Subnavbar>\r\n      </Navbar>\r\n      <PageContent\r\n        infinite\r\n        infiniteDistance={50}\r\n        infinitePreloader={showPreloader}\r\n        onInfinite={loadMore}\r\n        style={{ paddingTop: '88px' }}\r\n      >\r\n        <List>\r\n          <ListItem\r\n            title=\"全部类型\"\r\n            onClick={() => handleselect({ value: undefined, text: '全部类型' })}\r\n          />\r\n          {searchOptions.map((item, index) => {\r\n            return <ListItem key={index} title={item.text} onClick={() => handleselect(item)} />;\r\n          })}\r\n        </List>\r\n      </PageContent>\r\n    </Page>\r\n  );\r\n};\r\n\r\nexport default MaterialSearch;\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}