{"ast":null,"code":"import $ from 'dom7';\nimport { document } from 'ssr-window';\nimport Utils from '../../utils/utils';\nconst Swipeout = {\n  init() {\n    const app = this;\n    const touchesStart = {};\n    let isTouched;\n    let isMoved;\n    let isScrolling;\n    let touchStartTime;\n    let touchesDiff;\n    let $swipeoutEl;\n    let $swipeoutContent;\n    let $actionsRight;\n    let $actionsLeft;\n    let actionsLeftWidth;\n    let actionsRightWidth;\n    let translate;\n    let opened;\n    let openedActionsSide;\n    let $leftButtons;\n    let $rightButtons;\n    let direction;\n    let $overswipeLeftButton;\n    let $overswipeRightButton;\n    let overswipeLeft;\n    let overswipeRight;\n\n    function handleTouchStart(e) {\n      if (!Swipeout.allow) return;\n      isMoved = false;\n      isTouched = true;\n      isScrolling = undefined;\n      touchesStart.x = e.type === 'touchstart' ? e.targetTouches[0].pageX : e.pageX;\n      touchesStart.y = e.type === 'touchstart' ? e.targetTouches[0].pageY : e.pageY;\n      touchStartTime = new Date().getTime();\n      $swipeoutEl = $(this);\n    }\n\n    function handleTouchMove(e) {\n      if (!isTouched) return;\n      const pageX = e.type === 'touchmove' ? e.targetTouches[0].pageX : e.pageX;\n      const pageY = e.type === 'touchmove' ? e.targetTouches[0].pageY : e.pageY;\n\n      if (typeof isScrolling === 'undefined') {\n        isScrolling = !!(isScrolling || Math.abs(pageY - touchesStart.y) > Math.abs(pageX - touchesStart.x));\n      }\n\n      if (isScrolling) {\n        isTouched = false;\n        return;\n      }\n\n      if (!isMoved) {\n        if ($('.list.sortable-opened').length > 0) return;\n        $swipeoutContent = $swipeoutEl.find('.swipeout-content');\n        $actionsRight = $swipeoutEl.find('.swipeout-actions-right');\n        $actionsLeft = $swipeoutEl.find('.swipeout-actions-left');\n        actionsLeftWidth = null;\n        actionsRightWidth = null;\n        $leftButtons = null;\n        $rightButtons = null;\n        $overswipeRightButton = null;\n        $overswipeLeftButton = null;\n\n        if ($actionsLeft.length > 0) {\n          actionsLeftWidth = $actionsLeft.outerWidth();\n          $leftButtons = $actionsLeft.children('a');\n          $overswipeLeftButton = $actionsLeft.find('.swipeout-overswipe');\n        }\n\n        if ($actionsRight.length > 0) {\n          actionsRightWidth = $actionsRight.outerWidth();\n          $rightButtons = $actionsRight.children('a');\n          $overswipeRightButton = $actionsRight.find('.swipeout-overswipe');\n        }\n\n        opened = $swipeoutEl.hasClass('swipeout-opened');\n\n        if (opened) {\n          openedActionsSide = $swipeoutEl.find('.swipeout-actions-left.swipeout-actions-opened').length > 0 ? 'left' : 'right';\n        }\n\n        $swipeoutEl.removeClass('swipeout-transitioning');\n\n        if (!app.params.swipeout.noFollow) {\n          $swipeoutEl.find('.swipeout-actions-opened').removeClass('swipeout-actions-opened');\n          $swipeoutEl.removeClass('swipeout-opened');\n        }\n      }\n\n      isMoved = true;\n      e.preventDefault();\n      touchesDiff = pageX - touchesStart.x;\n      translate = touchesDiff;\n\n      if (opened) {\n        if (openedActionsSide === 'right') translate -= actionsRightWidth;else translate += actionsLeftWidth;\n      }\n\n      if (translate > 0 && $actionsLeft.length === 0 || translate < 0 && $actionsRight.length === 0) {\n        if (!opened) {\n          isTouched = false;\n          isMoved = false;\n          $swipeoutContent.transform('');\n\n          if ($rightButtons && $rightButtons.length > 0) {\n            $rightButtons.transform('');\n          }\n\n          if ($leftButtons && $leftButtons.length > 0) {\n            $leftButtons.transform('');\n          }\n\n          return;\n        }\n\n        translate = 0;\n      }\n\n      if (translate < 0) direction = 'to-left';else if (translate > 0) direction = 'to-right';else if (!direction) direction = 'to-left';\n      let buttonOffset;\n      let progress;\n      e.f7PreventSwipePanel = true;\n\n      if (app.params.swipeout.noFollow) {\n        if (opened) {\n          if (openedActionsSide === 'right' && touchesDiff > 0) {\n            app.swipeout.close($swipeoutEl);\n          }\n\n          if (openedActionsSide === 'left' && touchesDiff < 0) {\n            app.swipeout.close($swipeoutEl);\n          }\n        } else {\n          if (touchesDiff < 0 && $actionsRight.length > 0) {\n            app.swipeout.open($swipeoutEl, 'right');\n          }\n\n          if (touchesDiff > 0 && $actionsLeft.length > 0) {\n            app.swipeout.open($swipeoutEl, 'left');\n          }\n        }\n\n        isTouched = false;\n        isMoved = false;\n        return;\n      }\n\n      overswipeLeft = false;\n      overswipeRight = false;\n\n      if ($actionsRight.length > 0) {\n        // Show right actions\n        let buttonTranslate = translate;\n        progress = buttonTranslate / actionsRightWidth;\n\n        if (buttonTranslate < -actionsRightWidth) {\n          buttonTranslate = -actionsRightWidth - (-buttonTranslate - actionsRightWidth) ** 0.8;\n          translate = buttonTranslate;\n\n          if ($overswipeRightButton.length > 0) {\n            overswipeRight = true;\n          }\n        }\n\n        if (direction !== 'to-left') {\n          progress = 0;\n          buttonTranslate = 0;\n        }\n\n        $rightButtons.each((index, buttonEl) => {\n          const $buttonEl = $(buttonEl);\n\n          if (typeof buttonEl.f7SwipeoutButtonOffset === 'undefined') {\n            $buttonEl[0].f7SwipeoutButtonOffset = buttonEl.offsetLeft;\n          }\n\n          buttonOffset = buttonEl.f7SwipeoutButtonOffset;\n\n          if ($overswipeRightButton.length > 0 && $buttonEl.hasClass('swipeout-overswipe') && direction === 'to-left') {\n            $buttonEl.css({\n              left: `${overswipeRight ? -buttonOffset : 0}px`\n            });\n\n            if (overswipeRight) {\n              if (!$buttonEl.hasClass('swipeout-overswipe-active')) {\n                $swipeoutEl.trigger('swipeout:overswipeenter');\n                app.emit('swipeoutOverswipeEnter', $swipeoutEl[0]);\n              }\n\n              $buttonEl.addClass('swipeout-overswipe-active');\n            } else {\n              if ($buttonEl.hasClass('swipeout-overswipe-active')) {\n                $swipeoutEl.trigger('swipeout:overswipeexit');\n                app.emit('swipeoutOverswipeExit', $swipeoutEl[0]);\n              }\n\n              $buttonEl.removeClass('swipeout-overswipe-active');\n            }\n          }\n\n          $buttonEl.transform(`translate3d(${buttonTranslate - buttonOffset * (1 + Math.max(progress, -1))}px,0,0)`);\n        });\n      }\n\n      if ($actionsLeft.length > 0) {\n        // Show left actions\n        let buttonTranslate = translate;\n        progress = buttonTranslate / actionsLeftWidth;\n\n        if (buttonTranslate > actionsLeftWidth) {\n          buttonTranslate = actionsLeftWidth + (buttonTranslate - actionsLeftWidth) ** 0.8;\n          translate = buttonTranslate;\n\n          if ($overswipeLeftButton.length > 0) {\n            overswipeLeft = true;\n          }\n        }\n\n        if (direction !== 'to-right') {\n          buttonTranslate = 0;\n          progress = 0;\n        }\n\n        $leftButtons.each((index, buttonEl) => {\n          const $buttonEl = $(buttonEl);\n\n          if (typeof buttonEl.f7SwipeoutButtonOffset === 'undefined') {\n            $buttonEl[0].f7SwipeoutButtonOffset = actionsLeftWidth - buttonEl.offsetLeft - buttonEl.offsetWidth;\n          }\n\n          buttonOffset = buttonEl.f7SwipeoutButtonOffset;\n\n          if ($overswipeLeftButton.length > 0 && $buttonEl.hasClass('swipeout-overswipe') && direction === 'to-right') {\n            $buttonEl.css({\n              left: `${overswipeLeft ? buttonOffset : 0}px`\n            });\n\n            if (overswipeLeft) {\n              if (!$buttonEl.hasClass('swipeout-overswipe-active')) {\n                $swipeoutEl.trigger('swipeout:overswipeenter');\n                app.emit('swipeoutOverswipeEnter', $swipeoutEl[0]);\n              }\n\n              $buttonEl.addClass('swipeout-overswipe-active');\n            } else {\n              if ($buttonEl.hasClass('swipeout-overswipe-active')) {\n                $swipeoutEl.trigger('swipeout:overswipeexit');\n                app.emit('swipeoutOverswipeExit', $swipeoutEl[0]);\n              }\n\n              $buttonEl.removeClass('swipeout-overswipe-active');\n            }\n          }\n\n          if ($leftButtons.length > 1) {\n            $buttonEl.css('z-index', $leftButtons.length - index);\n          }\n\n          $buttonEl.transform(`translate3d(${buttonTranslate + buttonOffset * (1 - Math.min(progress, 1))}px,0,0)`);\n        });\n      }\n\n      $swipeoutEl.trigger('swipeout', progress);\n      app.emit('swipeout', $swipeoutEl[0], progress);\n      $swipeoutContent.transform(`translate3d(${translate}px,0,0)`);\n    }\n\n    function handleTouchEnd() {\n      if (!isTouched || !isMoved) {\n        isTouched = false;\n        isMoved = false;\n        return;\n      }\n\n      isTouched = false;\n      isMoved = false;\n      const timeDiff = new Date().getTime() - touchStartTime;\n      const $actions = direction === 'to-left' ? $actionsRight : $actionsLeft;\n      const actionsWidth = direction === 'to-left' ? actionsRightWidth : actionsLeftWidth;\n      let action;\n      let $buttons;\n      let i;\n\n      if (timeDiff < 300 && (touchesDiff < -10 && direction === 'to-left' || touchesDiff > 10 && direction === 'to-right') || timeDiff >= 300 && Math.abs(translate) > actionsWidth / 2) {\n        action = 'open';\n      } else {\n        action = 'close';\n      }\n\n      if (timeDiff < 300) {\n        if (Math.abs(translate) === 0) action = 'close';\n        if (Math.abs(translate) === actionsWidth) action = 'open';\n      }\n\n      if (action === 'open') {\n        Swipeout.el = $swipeoutEl[0];\n        $swipeoutEl.trigger('swipeout:open');\n        app.emit('swipeoutOpen', $swipeoutEl[0]);\n        $swipeoutEl.addClass('swipeout-opened swipeout-transitioning');\n        const newTranslate = direction === 'to-left' ? -actionsWidth : actionsWidth;\n        $swipeoutContent.transform(`translate3d(${newTranslate}px,0,0)`);\n        $actions.addClass('swipeout-actions-opened');\n        $buttons = direction === 'to-left' ? $rightButtons : $leftButtons;\n\n        if ($buttons) {\n          for (i = 0; i < $buttons.length; i += 1) {\n            $($buttons[i]).transform(`translate3d(${newTranslate}px,0,0)`);\n          }\n        }\n\n        if (overswipeRight) {\n          $actionsRight.find('.swipeout-overswipe').trigger('click', 'f7Overswipe');\n        }\n\n        if (overswipeLeft) {\n          $actionsLeft.find('.swipeout-overswipe').trigger('click', 'f7Overswipe');\n        }\n      } else {\n        $swipeoutEl.trigger('swipeout:close');\n        app.emit('swipeoutClose', $swipeoutEl[0]);\n        Swipeout.el = undefined;\n        $swipeoutEl.addClass('swipeout-transitioning').removeClass('swipeout-opened');\n        $swipeoutContent.transform('');\n        $actions.removeClass('swipeout-actions-opened');\n      }\n\n      let buttonOffset;\n\n      if ($leftButtons && $leftButtons.length > 0 && $leftButtons !== $buttons) {\n        $leftButtons.each((index, buttonEl) => {\n          const $buttonEl = $(buttonEl);\n          buttonOffset = buttonEl.f7SwipeoutButtonOffset;\n\n          if (typeof buttonOffset === 'undefined') {\n            $buttonEl[0].f7SwipeoutButtonOffset = actionsLeftWidth - buttonEl.offsetLeft - buttonEl.offsetWidth;\n          }\n\n          $buttonEl.transform(`translate3d(${buttonOffset}px,0,0)`);\n        });\n      }\n\n      if ($rightButtons && $rightButtons.length > 0 && $rightButtons !== $buttons) {\n        $rightButtons.each((index, buttonEl) => {\n          const $buttonEl = $(buttonEl);\n          buttonOffset = buttonEl.f7SwipeoutButtonOffset;\n\n          if (typeof buttonOffset === 'undefined') {\n            $buttonEl[0].f7SwipeoutButtonOffset = buttonEl.offsetLeft;\n          }\n\n          $buttonEl.transform(`translate3d(${-buttonOffset}px,0,0)`);\n        });\n      }\n\n      $swipeoutContent.transitionEnd(() => {\n        if (opened && action === 'open' || !opened && action === 'close') return;\n        $swipeoutEl.trigger(action === 'open' ? 'swipeout:opened' : 'swipeout:closed');\n        app.emit(action === 'open' ? 'swipeoutOpened' : 'swipeoutClosed', $swipeoutEl[0]);\n        $swipeoutEl.removeClass('swipeout-transitioning');\n\n        if (opened && action === 'close') {\n          if ($actionsRight.length > 0) {\n            $rightButtons.transform('');\n          }\n\n          if ($actionsLeft.length > 0) {\n            $leftButtons.transform('');\n          }\n        }\n      });\n    }\n\n    const passiveListener = app.support.passiveListener ? {\n      passive: true\n    } : false;\n    app.on('touchstart', e => {\n      if (Swipeout.el) {\n        const $targetEl = $(e.target);\n\n        if (!($(Swipeout.el).is($targetEl[0]) || $targetEl.parents('.swipeout').is(Swipeout.el) || $targetEl.hasClass('modal-in') || ($targetEl.attr('class') || '').indexOf('-backdrop') > 0 || $targetEl.hasClass('actions-modal') || $targetEl.parents('.actions-modal.modal-in, .dialog.modal-in').length > 0)) {\n          app.swipeout.close(Swipeout.el);\n        }\n      }\n    });\n    $(document).on(app.touchEvents.start, 'li.swipeout', handleTouchStart, passiveListener);\n    app.on('touchmove:active', handleTouchMove);\n    app.on('touchend:passive', handleTouchEnd);\n  },\n\n  allow: true,\n  el: undefined,\n\n  open() {\n    const app = this;\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    let [el, side, callback] = args;\n\n    if (typeof args[1] === 'function') {\n      [el, callback, side] = args;\n    }\n\n    const $el = $(el).eq(0);\n    if ($el.length === 0) return;\n    if (!$el.hasClass('swipeout') || $el.hasClass('swipeout-opened')) return;\n\n    if (!side) {\n      if ($el.find('.swipeout-actions-right').length > 0) side = 'right';else side = 'left';\n    }\n\n    const $swipeoutActions = $el.find(`.swipeout-actions-${side}`);\n    const $swipeoutContent = $el.find('.swipeout-content');\n    if ($swipeoutActions.length === 0) return;\n    $el.trigger('swipeout:open').addClass('swipeout-opened').removeClass('swipeout-transitioning');\n    app.emit('swipeoutOpen', $el[0]);\n    $swipeoutActions.addClass('swipeout-actions-opened');\n    const $buttons = $swipeoutActions.children('a');\n    const swipeoutActionsWidth = $swipeoutActions.outerWidth();\n    const translate = side === 'right' ? -swipeoutActionsWidth : swipeoutActionsWidth;\n\n    if ($buttons.length > 1) {\n      $buttons.each((buttonIndex, buttonEl) => {\n        const $buttonEl = $(buttonEl);\n\n        if (side === 'right') {\n          $buttonEl.transform(`translate3d(${-buttonEl.offsetLeft}px,0,0)`);\n        } else {\n          $buttonEl.css('z-index', $buttons.length - buttonIndex).transform(`translate3d(${swipeoutActionsWidth - buttonEl.offsetWidth - buttonEl.offsetLeft}px,0,0)`);\n        }\n      });\n    }\n\n    $el.addClass('swipeout-transitioning');\n    $swipeoutContent.transitionEnd(() => {\n      $el.trigger('swipeout:opened');\n      app.emit('swipeoutOpened', $el[0]);\n      if (callback) callback.call($el[0]);\n    });\n    Utils.nextFrame(() => {\n      $buttons.transform(`translate3d(${translate}px,0,0)`);\n      $swipeoutContent.transform(`translate3d(${translate}px,0,0)`);\n    });\n    Swipeout.el = $el[0];\n  },\n\n  close(el, callback) {\n    const app = this;\n    const $el = $(el).eq(0);\n    if ($el.length === 0) return;\n    if (!$el.hasClass('swipeout-opened')) return;\n    const side = $el.find('.swipeout-actions-opened').hasClass('swipeout-actions-right') ? 'right' : 'left';\n    const $swipeoutActions = $el.find('.swipeout-actions-opened').removeClass('swipeout-actions-opened');\n    const $buttons = $swipeoutActions.children('a');\n    const swipeoutActionsWidth = $swipeoutActions.outerWidth();\n    Swipeout.allow = false;\n    $el.trigger('swipeout:close');\n    app.emit('swipeoutClose', $el[0]);\n    $el.removeClass('swipeout-opened').addClass('swipeout-transitioning');\n    let closeTimeout;\n\n    function onSwipeoutClose() {\n      Swipeout.allow = true;\n      if ($el.hasClass('swipeout-opened')) return;\n      $el.removeClass('swipeout-transitioning');\n      $buttons.transform('');\n      $el.trigger('swipeout:closed');\n      app.emit('swipeoutClosed', $el[0]);\n      if (callback) callback.call($el[0]);\n      if (closeTimeout) clearTimeout(closeTimeout);\n    }\n\n    $el.find('.swipeout-content').transform('').transitionEnd(onSwipeoutClose);\n    closeTimeout = setTimeout(onSwipeoutClose, 500);\n    $buttons.each((index, buttonEl) => {\n      const $buttonEl = $(buttonEl);\n\n      if (side === 'right') {\n        $buttonEl.transform(`translate3d(${-buttonEl.offsetLeft}px,0,0)`);\n      } else {\n        $buttonEl.transform(`translate3d(${swipeoutActionsWidth - buttonEl.offsetWidth - buttonEl.offsetLeft}px,0,0)`);\n      }\n\n      $buttonEl.css({\n        left: '0px'\n      }).removeClass('swipeout-overswipe-active');\n    });\n    if (Swipeout.el && Swipeout.el === $el[0]) Swipeout.el = undefined;\n  },\n\n  delete(el, callback) {\n    const app = this;\n    const $el = $(el).eq(0);\n    if ($el.length === 0) return;\n    Swipeout.el = undefined;\n    $el.trigger('swipeout:delete');\n    app.emit('swipeoutDelete', $el[0]);\n    $el.css({\n      height: `${$el.outerHeight()}px`\n    });\n    $el.transitionEnd(() => {\n      $el.trigger('swipeout:deleted');\n      app.emit('swipeoutDeleted', $el[0]);\n      if (callback) callback.call($el[0]);\n\n      if ($el.parents('.virtual-list').length > 0) {\n        const virtualList = $el.parents('.virtual-list')[0].f7VirtualList;\n        const virtualIndex = $el[0].f7VirtualListIndex;\n        if (virtualList && typeof virtualIndex !== 'undefined') virtualList.deleteItem(virtualIndex);\n      } else if (app.params.swipeout.removeElements) {\n        if (app.params.swipeout.removeElementsWithTimeout) {\n          setTimeout(() => {\n            $el.remove();\n          }, app.params.swipeout.removeElementsTimeout);\n        } else {\n          $el.remove();\n        }\n      } else {\n        $el.removeClass('swipeout-deleting swipeout-transitioning');\n      }\n    }); // eslint-disable-next-line\n    // $el[0]._clientLeft = $el[0].clientLeft;\n\n    Utils.nextFrame(() => {\n      $el.addClass('swipeout-deleting swipeout-transitioning').css({\n        height: '0px'\n      }).find('.swipeout-content').transform('translate3d(-100%,0,0)');\n    });\n  }\n\n};\nexport default {\n  name: 'swipeout',\n  params: {\n    swipeout: {\n      actionsNoFold: false,\n      noFollow: false,\n      removeElements: true,\n      removeElementsWithTimeout: false,\n      removeElementsTimeout: 0\n    }\n  },\n\n  create() {\n    const app = this;\n    Utils.extend(app, {\n      swipeout: {\n        init: Swipeout.init.bind(app),\n        open: Swipeout.open.bind(app),\n        close: Swipeout.close.bind(app),\n        delete: Swipeout.delete.bind(app)\n      }\n    });\n    Object.defineProperty(app.swipeout, 'el', {\n      enumerable: true,\n      configurable: true,\n      get: () => Swipeout.el,\n\n      set(el) {\n        Swipeout.el = el;\n      }\n\n    });\n    Object.defineProperty(app.swipeout, 'allow', {\n      enumerable: true,\n      configurable: true,\n      get: () => Swipeout.allow,\n\n      set(allow) {\n        Swipeout.allow = allow;\n      }\n\n    });\n  },\n\n  clicks: {\n    '.swipeout-open': function openSwipeout($clickedEl) {\n      let data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      const app = this;\n      app.swipeout.open(data.swipeout, data.side);\n    },\n    '.swipeout-close': function closeSwipeout($clickedEl) {\n      const app = this;\n      const $swipeoutEl = $clickedEl.closest('.swipeout');\n      if ($swipeoutEl.length === 0) return;\n      app.swipeout.close($swipeoutEl);\n    },\n    '.swipeout-delete': function deleteSwipeout($clickedEl) {\n      let data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      const app = this;\n      const $swipeoutEl = $clickedEl.closest('.swipeout');\n      if ($swipeoutEl.length === 0) return;\n      const {\n        confirm,\n        confirmTitle\n      } = data;\n\n      if (data.confirm) {\n        app.dialog.confirm(confirm, confirmTitle, () => {\n          app.swipeout.delete($swipeoutEl);\n        });\n      } else {\n        app.swipeout.delete($swipeoutEl);\n      }\n    }\n  },\n  on: {\n    init() {\n      const app = this;\n      if (!app.params.swipeout) return;\n      app.swipeout.init();\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}