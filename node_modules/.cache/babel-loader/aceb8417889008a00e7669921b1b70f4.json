{"ast":null,"code":"import Utils from '../../utils/utils';\nconst SW = {\n  registrations: [],\n\n  register(path, scope) {\n    const app = this;\n\n    if (!('serviceWorker' in window.navigator) || !app.serviceWorker.container) {\n      return new Promise((resolve, reject) => {\n        reject(new Error('Service worker is not supported'));\n      });\n    }\n\n    return new Promise((resolve, reject) => {\n      app.serviceWorker.container.register(path, scope ? {\n        scope\n      } : {}).then(reg => {\n        SW.registrations.push(reg);\n        app.emit('serviceWorkerRegisterSuccess', reg);\n        resolve(reg);\n      }).catch(error => {\n        app.emit('serviceWorkerRegisterError', error);\n        reject(error);\n      });\n    });\n  },\n\n  unregister(registration) {\n    const app = this;\n\n    if (!('serviceWorker' in window.navigator) || !app.serviceWorker.container) {\n      return new Promise((resolve, reject) => {\n        reject(new Error('Service worker is not supported'));\n      });\n    }\n\n    let registrations;\n    if (!registration) registrations = SW.registrations;else if (Array.isArray(registration)) registrations = registration;else registrations = [registration];\n    return Promise.all(registrations.map(reg => new Promise((resolve, reject) => {\n      reg.unregister().then(() => {\n        if (SW.registrations.indexOf(reg) >= 0) {\n          SW.registrations.splice(SW.registrations.indexOf(reg), 1);\n        }\n\n        app.emit('serviceWorkerUnregisterSuccess', reg);\n        resolve();\n      }).catch(error => {\n        app.emit('serviceWorkerUnregisterError', reg, error);\n        reject(error);\n      });\n    })));\n  }\n\n};\nexport default {\n  name: 'sw',\n  params: {\n    serviceWorker: {\n      path: undefined,\n      scope: undefined\n    }\n  },\n\n  create() {\n    const app = this;\n    Utils.extend(app, {\n      serviceWorker: {\n        container: 'serviceWorker' in window.navigator ? window.navigator.serviceWorker : undefined,\n        registrations: SW.registrations,\n        register: SW.register.bind(app),\n        unregister: SW.unregister.bind(app)\n      }\n    });\n  },\n\n  on: {\n    init() {\n      if (!('serviceWorker' in window.navigator)) return;\n      const app = this;\n      if (!app.serviceWorker.container) return;\n      const paths = app.params.serviceWorker.path;\n      const scope = app.params.serviceWorker.scope;\n      if (!paths || Array.isArray(paths) && !paths.length) return;\n      const toRegister = Array.isArray(paths) ? paths : [paths];\n      toRegister.forEach(path => {\n        app.serviceWorker.register(path, scope);\n      });\n    }\n\n  }\n};","map":null,"metadata":{},"sourceType":"module"}