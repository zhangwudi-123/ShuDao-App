{"ast":null,"code":"var _jsxFileName = \"F:\\\\project\\\\vsCode\\\\bc-app\\\\src\\\\pages\\\\BatchScan\\\\index.js\";\nimport React, { useEffect, useMemo, useRef, useState, useCallback } from 'react';\nimport { Page, Navbar, NavLeft, NavTitle, PageContent, Button, BlockTitle } from '@hvisions/f-ui';\nimport moment from 'moment';\nimport { session, tree } from '@hvisions/toolkit';\nimport { isEmpty, debounce } from 'lodash';\nimport { onToast, createDialog } from '~/util/home';\nimport BatchScanService from '~/api/batchScan';\nimport styles from './style.scss';\nimport backIcon from '~/pages/WarehousinManage/img/backIcon.png';\n\nconst BatchScan = _ref => {\n  let {\n    f7router,\n    moduleList,\n    ...props\n  } = _ref;\n  const [inputPlaceHolder, setInputPlaceHolder] = useState('请扫码');\n  const [allNumbers, setAllNumbers] = useState([]);\n  const inputRef = useRef(null);\n  const keyDown = useCallback(e => {\n    if (!window.cordova) {\n      return;\n    }\n\n    window.cordova.define.moduleMap['scanPda.scanPda'].exports.coolMethod('start', function (data) {\n      //handleNext(data);\n      setAllNumbers(cur => {\n        if (cur.includes(data)) {\n          return cur;\n        }\n\n        return [...cur, data];\n      });\n    });\n  }, []);\n  useEffect(() => {\n    setTimeout(() => {\n      var _inputRef$current;\n\n      (_inputRef$current = inputRef.current) === null || _inputRef$current === void 0 ? void 0 : _inputRef$current.focus();\n    }, 500);\n  }, []);\n\n  const handleSubmit = () => {\n    if (isEmpty(allNumbers)) {\n      return;\n    }\n\n    BatchScanService.scanInStock(allNumbers).then(res => {\n      onToast('提交成功', styles.toastSuccess);\n      setAllNumbers([]);\n    }).catch(err => {\n      onToast(err.message, styles.toastError);\n    });\n  };\n\n  return /*#__PURE__*/React.createElement(Page, {\n    pageContent: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Navbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 49,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(NavLeft, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 50,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"a\", {\n    onClick: () => f7router.back(),\n    className: \"ne-navleft\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 51,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    alt: \"\",\n    style: {\n      height: 24\n    },\n    src: backIcon,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 13\n    }\n  }))), /*#__PURE__*/React.createElement(NavTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 55,\n      columnNumber: 9\n    }\n  }, \"\\u6279\\u91CF\\u626B\\u7801\")), /*#__PURE__*/React.createElement(PageContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      margin: '16px 16px 72px 16px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    placeholder: inputPlaceHolder,\n    ref: inputRef,\n    readOnly: true,\n    onFocus: () => {\n      setInputPlaceHolder('请扫码');\n      document.addEventListener('keydown', keyDown);\n    },\n    onBlur: () => {\n      inputRef.current.value = '';\n      setInputPlaceHolder('请点击进行扫码');\n      document.removeEventListener('keydown', keyDown);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 59,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(BlockTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 11\n    }\n  }, \"\\u5DF2\\u626B\\u7801\\u5217\\u8868\"), allNumbers.map((i, index) => /*#__PURE__*/React.createElement(\"div\", {\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 13\n    }\n  }, i)))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"ne-bottom-container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    className: \"ne-bottom-btn\",\n    disabled: isEmpty(allNumbers),\n    onClick: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 9\n    }\n  }, \"\\u63D0\\u4EA4\")));\n};\n\nexport default BatchScan;","map":{"version":3,"names":["React","useEffect","useMemo","useRef","useState","useCallback","Page","Navbar","NavLeft","NavTitle","PageContent","Button","BlockTitle","moment","session","tree","isEmpty","debounce","onToast","createDialog","BatchScanService","styles","backIcon","BatchScan","f7router","moduleList","props","inputPlaceHolder","setInputPlaceHolder","allNumbers","setAllNumbers","inputRef","keyDown","e","window","cordova","define","moduleMap","exports","coolMethod","data","cur","includes","setTimeout","current","focus","handleSubmit","scanInStock","then","res","toastSuccess","catch","err","message","toastError","back","height","margin","document","addEventListener","value","removeEventListener","map","i","index"],"sources":["F:/project/vsCode/bc-app/src/pages/BatchScan/index.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState, useCallback } from 'react';\r\nimport { Page, Navbar, NavLeft, NavTitle, PageContent, Button, BlockTitle } from '@hvisions/f-ui';\r\nimport moment from 'moment';\r\nimport { session, tree } from '@hvisions/toolkit';\r\nimport { isEmpty, debounce } from 'lodash';\r\nimport { onToast, createDialog } from '~/util/home';\r\nimport BatchScanService from '~/api/batchScan';\r\nimport styles from './style.scss';\r\n\r\nimport backIcon from '~/pages/WarehousinManage/img/backIcon.png';\r\nconst BatchScan = ({ f7router, moduleList, ...props }) => {\r\n  const [inputPlaceHolder, setInputPlaceHolder] = useState('请扫码');\r\n  const [allNumbers, setAllNumbers] = useState([]);\r\n  const inputRef = useRef(null);\r\n  const keyDown = useCallback(e => {\r\n    if (!window.cordova) {\r\n      return;\r\n    }\r\n    window.cordova.define.moduleMap['scanPda.scanPda'].exports.coolMethod('start', function(data) {\r\n      //handleNext(data);\r\n      setAllNumbers(cur => {\r\n        if (cur.includes(data)) {\r\n          return cur;\r\n        }\r\n        return [...cur, data];\r\n      });\r\n    });\r\n  }, []);\r\n  useEffect(() => {\r\n    setTimeout(() => {\r\n      inputRef.current?.focus();\r\n    }, 500);\r\n  }, []);\r\n  const handleSubmit = () => {\r\n    if (isEmpty(allNumbers)) {\r\n      return;\r\n    }\r\n    BatchScanService.scanInStock(allNumbers)\r\n      .then(res => {\r\n        onToast('提交成功', styles.toastSuccess);\r\n        setAllNumbers([]);\r\n      })\r\n      .catch(err => {\r\n        onToast(err.message, styles.toastError);\r\n      });\r\n  };\r\n  return (\r\n    <Page pageContent={false}>\r\n      <Navbar>\r\n        <NavLeft>\r\n          <a onClick={() => f7router.back()} className=\"ne-navleft\">\r\n            <img alt=\"\" style={{ height: 24 }} src={backIcon} />\r\n          </a>\r\n        </NavLeft>\r\n        <NavTitle>批量扫码</NavTitle>\r\n      </Navbar>\r\n      <PageContent>\r\n        <div style={{ margin: '16px 16px 72px 16px' }}>\r\n          <input\r\n            placeholder={inputPlaceHolder}\r\n            ref={inputRef}\r\n            readOnly\r\n            onFocus={() => {\r\n              setInputPlaceHolder('请扫码');\r\n              document.addEventListener('keydown', keyDown);\r\n            }}\r\n            onBlur={() => {\r\n              inputRef.current.value = '';\r\n              setInputPlaceHolder('请点击进行扫码');\r\n              document.removeEventListener('keydown', keyDown);\r\n            }}\r\n          ></input>\r\n          <BlockTitle>已扫码列表</BlockTitle>\r\n          {allNumbers.map((i, index) => (\r\n            <div key={index}>{i}</div>\r\n          ))}\r\n        </div>\r\n      </PageContent>\r\n\r\n      <div className=\"ne-bottom-container\">\r\n        <Button className=\"ne-bottom-btn\" disabled={isEmpty(allNumbers)} onClick={handleSubmit}>\r\n          提交\r\n        </Button>\r\n      </div>\r\n    </Page>\r\n  );\r\n};\r\n\r\nexport default BatchScan;\r\n"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,OAA3B,EAAoCC,MAApC,EAA4CC,QAA5C,EAAsDC,WAAtD,QAAyE,OAAzE;AACA,SAASC,IAAT,EAAeC,MAAf,EAAuBC,OAAvB,EAAgCC,QAAhC,EAA0CC,WAA1C,EAAuDC,MAAvD,EAA+DC,UAA/D,QAAiF,gBAAjF;AACA,OAAOC,MAAP,MAAmB,QAAnB;AACA,SAASC,OAAT,EAAkBC,IAAlB,QAA8B,mBAA9B;AACA,SAASC,OAAT,EAAkBC,QAAlB,QAAkC,QAAlC;AACA,SAASC,OAAT,EAAkBC,YAAlB,QAAsC,aAAtC;AACA,OAAOC,gBAAP,MAA6B,iBAA7B;AACA,OAAOC,MAAP,MAAmB,cAAnB;AAEA,OAAOC,QAAP,MAAqB,2CAArB;;AACA,MAAMC,SAAS,GAAG,QAAwC;EAAA,IAAvC;IAAEC,QAAF;IAAYC,UAAZ;IAAwB,GAAGC;EAA3B,CAAuC;EACxD,MAAM,CAACC,gBAAD,EAAmBC,mBAAnB,IAA0CxB,QAAQ,CAAC,KAAD,CAAxD;EACA,MAAM,CAACyB,UAAD,EAAaC,aAAb,IAA8B1B,QAAQ,CAAC,EAAD,CAA5C;EACA,MAAM2B,QAAQ,GAAG5B,MAAM,CAAC,IAAD,CAAvB;EACA,MAAM6B,OAAO,GAAG3B,WAAW,CAAC4B,CAAC,IAAI;IAC/B,IAAI,CAACC,MAAM,CAACC,OAAZ,EAAqB;MACnB;IACD;;IACDD,MAAM,CAACC,OAAP,CAAeC,MAAf,CAAsBC,SAAtB,CAAgC,iBAAhC,EAAmDC,OAAnD,CAA2DC,UAA3D,CAAsE,OAAtE,EAA+E,UAASC,IAAT,EAAe;MAC5F;MACAV,aAAa,CAACW,GAAG,IAAI;QACnB,IAAIA,GAAG,CAACC,QAAJ,CAAaF,IAAb,CAAJ,EAAwB;UACtB,OAAOC,GAAP;QACD;;QACD,OAAO,CAAC,GAAGA,GAAJ,EAASD,IAAT,CAAP;MACD,CALY,CAAb;IAMD,CARD;EASD,CAb0B,EAaxB,EAbwB,CAA3B;EAcAvC,SAAS,CAAC,MAAM;IACd0C,UAAU,CAAC,MAAM;MAAA;;MACf,qBAAAZ,QAAQ,CAACa,OAAT,wEAAkBC,KAAlB;IACD,CAFS,EAEP,GAFO,CAAV;EAGD,CAJQ,EAIN,EAJM,CAAT;;EAKA,MAAMC,YAAY,GAAG,MAAM;IACzB,IAAI9B,OAAO,CAACa,UAAD,CAAX,EAAyB;MACvB;IACD;;IACDT,gBAAgB,CAAC2B,WAAjB,CAA6BlB,UAA7B,EACGmB,IADH,CACQC,GAAG,IAAI;MACX/B,OAAO,CAAC,MAAD,EAASG,MAAM,CAAC6B,YAAhB,CAAP;MACApB,aAAa,CAAC,EAAD,CAAb;IACD,CAJH,EAKGqB,KALH,CAKSC,GAAG,IAAI;MACZlC,OAAO,CAACkC,GAAG,CAACC,OAAL,EAAchC,MAAM,CAACiC,UAArB,CAAP;IACD,CAPH;EAQD,CAZD;;EAaA,oBACE,oBAAC,IAAD;IAAM,WAAW,EAAE,KAAnB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,MAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,OAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAG,OAAO,EAAE,MAAM9B,QAAQ,CAAC+B,IAAT,EAAlB;IAAmC,SAAS,EAAC,YAA7C;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAK,GAAG,EAAC,EAAT;IAAY,KAAK,EAAE;MAAEC,MAAM,EAAE;IAAV,CAAnB;IAAmC,GAAG,EAAElC,QAAxC;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,CADF,CADF,eAME,oBAAC,QAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,8BANF,CADF,eASE,oBAAC,WAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IAAK,KAAK,EAAE;MAAEmC,MAAM,EAAE;IAAV,CAAZ;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE;IACE,WAAW,EAAE9B,gBADf;IAEE,GAAG,EAAEI,QAFP;IAGE,QAAQ,MAHV;IAIE,OAAO,EAAE,MAAM;MACbH,mBAAmB,CAAC,KAAD,CAAnB;MACA8B,QAAQ,CAACC,gBAAT,CAA0B,SAA1B,EAAqC3B,OAArC;IACD,CAPH;IAQE,MAAM,EAAE,MAAM;MACZD,QAAQ,CAACa,OAAT,CAAiBgB,KAAjB,GAAyB,EAAzB;MACAhC,mBAAmB,CAAC,SAAD,CAAnB;MACA8B,QAAQ,CAACG,mBAAT,CAA6B,SAA7B,EAAwC7B,OAAxC;IACD,CAZH;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,EADF,eAeE,oBAAC,UAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,oCAfF,EAgBGH,UAAU,CAACiC,GAAX,CAAe,CAACC,CAAD,EAAIC,KAAJ,kBACd;IAAK,GAAG,EAAEA,KAAV;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GAAkBD,CAAlB,CADD,CAhBH,CADF,CATF,eAgCE;IAAK,SAAS,EAAC,qBAAf;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,gBACE,oBAAC,MAAD;IAAQ,SAAS,EAAC,eAAlB;IAAkC,QAAQ,EAAE/C,OAAO,CAACa,UAAD,CAAnD;IAAiE,OAAO,EAAEiB,YAA1E;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,kBADF,CAhCF,CADF;AAwCD,CA5ED;;AA8EA,eAAevB,SAAf"},"metadata":{},"sourceType":"module"}