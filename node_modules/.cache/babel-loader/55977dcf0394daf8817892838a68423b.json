{"ast":null,"code":"\"use strict\";\n\nvar _regeneratorRuntime = require(\"F:\\\\project\\\\vsCode\\\\yw-app\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _react = _interopRequireDefault(require(\"react\"));\n\nvar _propTypes = _interopRequireDefault(require(\"prop-types\"));\n\nvar _reactRedux = require(\"react-redux\");\n\nvar _fUi = require(\"@hvisions/f-ui\");\n\nvar _toolkit = require(\"@hvisions/toolkit\");\n\nvar _actions = require(\"../../../store/session/actions\");\n\nvar _login = _interopRequireDefault(require(\"./login.scss\"));\n\nvar _sys_logo = _interopRequireDefault(require(\"./sys_logo.png\"));\n\nvar _ip = _interopRequireDefault(require(\"./ip.png\"));\n\nvar _port = _interopRequireDefault(require(\"./port.png\"));\n\nvar _Core = _interopRequireDefault(require(\"../../../Core\"));\n\nvar _homeTitle = _interopRequireDefault(require(\"../../Layout/Component/imgs/homeTitle.png\"));\n\nvar _lodash = require(\"lodash\");\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction _typeof(obj) {\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}\n\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) {\n  try {\n    var info = gen[key](arg);\n    var value = info.value;\n  } catch (error) {\n    reject(error);\n    return;\n  }\n\n  if (info.done) {\n    resolve(value);\n  } else {\n    Promise.resolve(value).then(_next, _throw);\n  }\n}\n\nfunction _asyncToGenerator(fn) {\n  return function () {\n    var self = this,\n        args = arguments;\n    return new Promise(function (resolve, reject) {\n      var gen = fn.apply(self, args);\n\n      function _next(value) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value);\n      }\n\n      function _throw(err) {\n        asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err);\n      }\n\n      _next(undefined);\n    });\n  };\n}\n\nfunction _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}\n\nfunction _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nfunction _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}\n\nfunction _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return _assertThisInitialized(self);\n}\n\nfunction _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}\n\nfunction _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}\n\nfunction _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) _setPrototypeOf(subClass, superClass);\n}\n\nfunction _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}\n\nfunction _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nvar getApiIP = _toolkit.session.getApiIP,\n    getApiPort = _toolkit.session.getApiPort,\n    getApiHttps = _toolkit.session.getApiHttps,\n    saveApiIP = _toolkit.session.saveApiIP,\n    saveApiPort = _toolkit.session.saveApiPort,\n    saveApiHttps = _toolkit.session.saveApiHttps;\n\nvar Login = /*#__PURE__*/function (_React$Component) {\n  _inherits(Login, _React$Component);\n\n  function Login(props) {\n    var _this;\n\n    _classCallCheck(this, Login);\n\n    _this = _possibleConstructorReturn(this, _getPrototypeOf(Login).call(this, props));\n\n    _defineProperty(_assertThisInitialized(_this), \"signIn\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var self, app, router;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              self = _assertThisInitialized(_this);\n              app = self.$f7;\n              router = self.$f7router;\n              _context.prev = 3;\n              _context.next = 6;\n              return _this.props.login({\n                account: self.state.username,\n                password: self.state.password,\n                siteNum: self.state.siteNum\n              });\n\n            case 6:\n              router.navigate('/');\n              _context.next = 12;\n              break;\n\n            case 9:\n              _context.prev = 9;\n              _context.t0 = _context[\"catch\"](3);\n              app.dialog.alert(_context.t0.message);\n\n            case 12:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[3, 9]]);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"saveSetting\", function () {\n      var ipReg = /^(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])\\.(\\d{1,2}|1\\d\\d|2[0-4]\\d|25[0-5])$/;\n      var hostReg = /^(?=^.{3,255}$)[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(\\.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+$/;\n\n      if ((0, _lodash.isEmpty)(_this.state.ip) || (0, _lodash.isEmpty)(_this.state.port)) {\n        _this.$f7.toast.create({\n          position: 'center',\n          text: 'ip和端口信息不完整',\n          closeTimeout: '2000'\n        }).open();\n\n        return;\n      }\n\n      if (!ipReg.test(_this.state.ip) && !hostReg.test(_this.state.ip)) {\n        _this.$f7.toast.create({\n          position: 'center',\n          text: 'ip信息不正确',\n          closeTimeout: '2000'\n        }).open();\n\n        return;\n      }\n\n      saveApiIP(_this.state.ip);\n      saveApiPort(_this.state.port); // saveApiHttps(this.state.useHttps);\n\n      _this.setState({\n        state: 'login'\n      });\n    });\n\n    _this.state = {\n      state: 'login',\n      username: '',\n      password: '',\n      siteNum: '',\n      ip: getApiIP(),\n      port: getApiPort(),\n      useHttps: getApiHttps()\n    };\n    return _this;\n  }\n\n  _createClass(Login, [{\n    key: \"renderForm\",\n    value: function renderForm() {\n      var _this2 = this;\n\n      if (this.state.state === 'login') {\n        return _react.default.createElement(_fUi.List, {\n          form: true\n        }, _react.default.createElement(_fUi.ListInput, {\n          label: \"\\u7528\\u6237\\u540D\",\n          type: \"text\",\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u7528\\u6237\\u540D\",\n          value: this.state.username,\n          onInput: function onInput(e) {\n            _this2.setState({\n              username: e.target.value\n            });\n          },\n          clearButton: true\n        }), _react.default.createElement(_fUi.ListInput, {\n          label: \"\\u5BC6\\u7801\",\n          type: \"password\",\n          placeholder: \"\\u8BF7\\u8F93\\u5165\\u5BC6\\u7801\",\n          value: this.state.password,\n          onInput: function onInput(e) {\n            _this2.setState({\n              password: e.target.value\n            });\n          },\n          clearButton: true\n        }), _Core.default.getSaas() && _react.default.createElement(_fUi.ListInput, {\n          type: \"text\",\n          placeholder: \"\\u4F01\\u4E1A\\u7F16\\u7801\",\n          value: this.state.siteNum,\n          onInput: function onInput(e) {\n            _this2.setState({\n              siteNum: e.target.value\n            });\n          },\n          clearButton: true\n        }, _react.default.createElement(_fUi.Icon, {\n          f7: \"house\",\n          slot: \"media\",\n          color: \"white\"\n        })), _react.default.createElement(_fUi.ListInput, {\n          className: _login.default.hide\n        }));\n      }\n\n      return _react.default.createElement(_fUi.List, {\n        form: true,\n        className: _login.default.configForm\n      }, _react.default.createElement(_fUi.ListInput, {\n        type: \"text\",\n        placeholder: \"\\u8BF7\\u8F93\\u5165ip(\\u793A\\u4F8B:127.0.0.1)\",\n        value: this.state.ip,\n        onInput: function onInput(e) {\n          _this2.setState({\n            ip: e.target.value\n          });\n        },\n        clearButton: true\n      }, _react.default.createElement(\"img\", {\n        src: _ip.default,\n        slot: \"media\",\n        alt: \"\",\n        style: {\n          width: 28\n        }\n      })), _react.default.createElement(_fUi.ListInput, {\n        type: \"text\",\n        placeholder: \"\\u8BF7\\u8F93\\u5165\\u7AEF\\u53E3(\\u793A\\u4F8B:3000)\",\n        value: this.state.port,\n        onInput: function onInput(e) {\n          _this2.setState({\n            port: e.target.value\n          });\n        },\n        clearButton: true\n      }, _react.default.createElement(\"img\", {\n        src: _port.default,\n        slot: \"media\",\n        alt: \"\",\n        style: {\n          width: 28\n        }\n      })));\n    }\n  }, {\n    key: \"renderBtn\",\n    value: function renderBtn() {\n      var _this3 = this;\n\n      if (this.state.state === 'login') {\n        return _react.default.createElement(_react.default.Fragment, null, _react.default.createElement(_fUi.Button, {\n          large: true,\n          raised: true,\n          fill: true,\n          round: true,\n          onClick: this.signIn\n        }, \"\\u767B\\u5F55\"), _react.default.createElement(_fUi.Button, {\n          color: \"gray\",\n          onClick: function onClick() {\n            return _this3.setState({\n              state: 'ip'\n            });\n          }\n        }, \"\\u8BBE\\u7F6E\"));\n      }\n\n      return _react.default.createElement(_react.default.Fragment, null, _react.default.createElement(_fUi.Button, {\n        round: true,\n        onClick: this.saveSetting\n      }, \"\\u4FDD\\u5B58\"), _react.default.createElement(_fUi.Button, {\n        color: \"gray\",\n        onClick: function onClick() {\n          return _this3.setState({\n            ip: getApiIP(),\n            port: getApiPort(),\n            state: 'login'\n          });\n        }\n      }, \"\\u8FD4\\u56DE\"));\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      return _react.default.createElement(_fUi.Page, {\n        noToolbar: true,\n        noNavbar: true,\n        noSwipeback: true,\n        loginScreen: true,\n        className: _login.default.login\n      }, _react.default.createElement(\"div\", {\n        className: _login.default.loginBg\n      }, _react.default.createElement(\"header\", {\n        className: _login.default.logo\n      }, _react.default.createElement(\"div\", {\n        className: _login.default.title\n      }, _react.default.createElement(\"img\", {\n        src: _homeTitle.default,\n        slot: \"media\",\n        alt: \"\",\n        style: {\n          height: '100%'\n        }\n      })), _react.default.createElement(\"div\", {\n        className: _login.default.welcome\n      }, \"\\u60A8\\u597D\\uFF0C\\u6B22\\u8FCE\\u767B\\u5F55\\uFF01\"), _react.default.createElement(\"div\", {\n        className: _login.default.hint\n      }, \"\\u8BF7\\u4F7F\\u7528\\u8D26\\u53F7\\u5BC6\\u7801\\u767B\\u5F55\")), _react.default.createElement(\"section\", {\n        className: _login.default.loginForm\n      }, this.renderForm(), _react.default.createElement(_fUi.Block, {\n        className: _login.default.loginBtn\n      }, this.renderBtn())), _react.default.createElement(\"div\", {\n        className: _login.default.footer\n      }, _react.default.createElement(\"div\", null, _Core.default.getHomeConfig().version || '版本号v2.0'), _react.default.createElement(\"div\", null, \"\\xA9\", ' ', _Core.default.getHomeConfig().bottomDesc || 'Copyright 2022 Shanghai H VISIONS Technology Co., Ltd.'))));\n    }\n  }]);\n\n  return Login;\n}(_react.default.Component);\n\nLogin.propTypes = {\n  login: _propTypes.default.func\n};\n\nvar mapStateToProps = function mapStateToProps() {\n  return {};\n};\n\nvar _default = (0, _reactRedux.connect)(mapStateToProps, {\n  login: _actions.login\n})(Login);\n\nexports.default = _default;","map":null,"metadata":{},"sourceType":"script"}