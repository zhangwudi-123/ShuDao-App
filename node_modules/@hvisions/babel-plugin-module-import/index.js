const HC_MODULE_REGX = /^@hvisions\/(module|client|app)-(?!core$)(\w+)$/;

module.exports = function({ types: t }) {
  return {
    visitor: {
      ImportDeclaration(path) {
        if (!HC_MODULE_REGX.test(path.node.source.value)) {
          return;
        }
        if (!path.node.specifiers.filter(item => Boolean(item.imported)).length) {
          return;
        }
        const newImports = path.node.specifiers.map(item => {
          if (!item.imported) {
            return t.importDeclaration(
              [t.importDefaultSpecifier(item.local)],
              t.stringLiteral(path.node.source.value)
            );
          }
          return t.importDeclaration(
            [t.importDefaultSpecifier(item.local)],
            t.stringLiteral(`${path.node.source.value}/lib/${item.local.name}`)
          );
        });
        path.replaceWithMultiple(newImports);
      }
    }
  };
};
